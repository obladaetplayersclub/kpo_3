# Окриашвили Константин. Система антиплагиата

Использовал Java 21, Spring Boot, Lombok и Hibernate для создания микросервисной системы, которая хранит студ работ и проверяет их на плагиат

## Описание

Данное веб-приложение нужно для того, что бы автоматизировать процесс проверки студенческих работ на плагиат, то есть создание антиплагиат системы. Предполагается, что преподаватели загружают работы студентов, система автоматически анализирует их и формирует отчеты о наличии каких-то взаимствований

### Основные возможности. Что умеет приложение

- Загрузка работ в формате txt с указанием ФИ студента и задания
- Автоматическое сохранение информации в БД
- Анализ файлов на наличие плагиата
- Получение отчетов по проверке
- Также, как дополнительная возможность, это визуализация работы в виде облаков слов

## Архитектура

Вот представление архитектуры в виде небольшой таблицы

```
            ┌─────────────┐
            │   Клиент    │
            └──────┬──────┘
                   │
                   ▼
┌─────────────────────────────────────┐
│         API Gateway (8080)          │
│  Единая точка входа для клиентов    │
└──────┬──────────────────┬───────────┘
       │                  │
       ▼                  ▼
┌──────────────┐    ┌──────────────────┐
│ File Storing │    │  File Analysis   │
│  Service     │    │     Service      │
│   (8081)     │    │      (8082)      │
└──────┬───────┘    └────────┬─────────┘
       │                     │
       └──────────┬──────────┘
                  ▼
         ┌─────────────────┐
         │    База Данных  │
         │      (5432)     │
         └─────────────────┘
```

### Какие микросервисы входят? 

#### 1. **File Storing Service** (Работает на порте 8081)
Что он делает:
- Прием и сохранение файлов на сервере, также сохранение метаданных о работе в Базу Данных(имя студента, задание и дата выгрузки )
- Выдача сохраненных файлов по запросу

**Основные компоненты:**
- `FileStoringController` - REST API для работы с файлами
- `FileStorageService` - бизнес-логика сохранения и получения файлов
- `WorkRepository` - доступ к данным о работах
- `Work` - сущность работы (студент, задание, путь к файлу)

#### 2. **File Analysis Service** (Работа на порте 8082)
Что он делает:
- Анализ загруженных файлов на наличие плагиата
- Хранение отчетов об анализе в БД
- Выдача отчетов по запросу
- Генерация облака слов для визуализации работы

**Основные компоненты:**
- `FileAnalysisController` - REST API для работы с анализом
- `FileAnalysisService` - бизнес-логика анализа файлов
- `AnalysisRepository` - доступ к отчетам
- `Analysis` - сущность отчета (результат проверки, хеш файла, детали)

#### 3. **API Gateway** (Порт 8080)
**Ответственность:**
- Единая точка входа для всех клиентских запросов
- Маршрутизация запросов к соответствующим микросервисам
- Обработка ошибок и недоступности сервисов
- Предоставление Swagger UI для тестирования API

**Основные компоненты:**
- `GatewayController` - проксирование запросов к микросервисам
- `WebClient` - HTTP клиент для межсервисного взаимодействия

## Как установить и запустить 

### Требования

- Docker и Docker Compose
- Java 21 (для локальной разработки)
- Maven (для локальной разработки)

### Запуск через Docker Compose

1. Нужно клонировать репозиторий в нужную папку
```bash
cd <папка>
git clone https://github.com/obladaetplayersclub/kpo_3.git
```

2. Далее запускаем сервисы:
```bash
docker compose up --build
```

Эта команда:
- Соберет Docker образы для всех микросервисов
В следствие:
- Запустит File Storing Service
- Запустит File Analysis Service
- Запустит API Gateway

3. На всякий случай рекомендую проверить, что все сервисы запущены:
```bash
docker compose ps
```

### Доступ к сервисам

После запуска сервисы будут доступны по следующим адресам:

- **API Gateway**: http://localhost:8080
- **Swagger UI**: http://localhost:8080/swagger-ui.html
- **File Storing Service**: http://localhost:8081
- **File Analysis Service**: http://localhost:8082
- **PostgreSQL**: localhost:5432

### Остановка сервисов

```bash
docker compose down
```

Для остановки и удаления всех данных:
```bash
docker compose down -v
```

## Как работать?

### Отправить файл

Все запросы к API выполняются через Gateway: `http://localhost:8080/api`

**Пример запроса (curl):**
```bash
curl -X POST "http://localhost:8080/api/files" \
  -F "file=@/path/to/file.txt" \
  -F "studentName=Константин Окриашвили" \
  -F "assignmentName=КПО ДЗ 1"
```

**Ответ:**
```json
{
  "id": 1,
  "studentName": "Константин Окриашвили",
  "assignmentName": "КПО ДЗ 1",
  "filePath": "/app/files/uuid-filename.txt",
  "uploadedAt": "2025-12-11T10:30:00"
}
```

#### Получить файл

**GET** `/api/files/{id}`

Получает файл по ID работы

**Пример запроса:**
```bash
curl -X GET "http://localhost:8080/api/files/1" --output file.txt
```

### Анализ файла

**POST** `/api/reports/analyze/{workId}`

Запускает анализ файла на плагиат, используя ID работы

**Пример запроса:**
```bash
curl -X POST "http://localhost:8080/api/reports/analyze/1"
```

**Ответ:**
```json
{
  "id": 1,
  "work": {
    "id": 1
  },
  "plagiarismDetected": false,
  "fileHash": "a1b2c3d4e5f6...",
  "analysisDate": "2025-12-11T10:31:00",
  "details": null
}
```

#### Получить отчет по работе

**GET** `/api/reports/{workId}`

Получаем все отчеты по определенной работы

**Пример запроса:**
```bash
curl -X GET "http://localhost:8080/api/reports/1"
```

**Ответ:**
```json
[
  {
    "id": 1,
    "work": {
      "id": 1
    },
    "plagiarismDetected": false,
    "fileHash": "a1b2c3d4e5f6...",
    "analysisDate": "2024-12-11T19:31:00",
    "details": null
  }
]
```

#### Получить облака слов

**GET** `/api/reports/{workId}/wordcloud`

Генерирует и возвращает изображение облака слов для работы


**Пример запроса:**
```bash
curl -X GET "http://localhost:8080/api/reports/1/wordcloud" --output wordcloud.png
```
**Ответ:** Изображение PNG с облаком слов

## Swagger UI

Также в проекте реализовал В проекте реализована автоматическая документация API с помощью **Swagger/OpenAPI 3.0**

### Использование

1. **Откройте Swagger UI**:
   ```
   http://localhost:8080/swagger-ui.html
   ```
   
2. **Просмотр документации**:
   - Все точки сгруппированы по тегам
   - Для каждого эндпоинта показаны параметры, примеры запросов и ответов
   - Описаны все возможные коды ответов (200, 404, 500, 503)

3. **Тестирование через Swagger UI**:
   - Нажмите "Try it out" на любом эндпоинте
   - Заполните параметры запроса
   - Нажмите "Execute" для отправки запроса
   - Просмотрите ответ сервера

4. **OpenAPI JSON схема**:
   ```
   http://localhost:8080/api-docs
   ```
   Доступна полная спецификация API в формате JSON для импорта в другие инструменты

### Особенности

- Интерактивное тестирование
- Визуализация:(Удобный интерфейс для просмотра всех эндпоинтов и их параметров)

### Postman Collection

Также добавил **Postman-коллекцию** для удобного тестирования API

#### Содержимое коллекции

Коллекция включает следующие запросы:

- **POST /api/files** 

- **GET /api/files/{id}**

- **GET /api/reports/{workId}** 

- **POST /api/reports/analyze/{workId}** 

- **GET /api/reports/{workId}/wordcloud**

### В чем плюс Postman?

- Готовые запросы
- Примеры данных
- Документация
- Переиспользование (можно легко поделиться коллекцией с командой)

## Алгоритм определения плагиата

Я решил использовать простой, но, как я считаю, эффективный алгоритм, который сравнивает хеши файлов, используя SHA-256

### Преимущества алгоритма:

- **Скорость**: сравнение хешей выполняется мгновенно
- **Точность**: SHA-256 гарантирует уникальность хеша для каждого файла
- **Эффективность**: не требует хранения полного содержимого файлов

### Ограничения:

- Алгоритм обнаруживает только **полные копии** файлов, то есть не обнаруживает частичные заимствования или перефразирование

